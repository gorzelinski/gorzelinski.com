import React, { useContext } from "react"
import { useTranslation } from "react-i18next"
import styled, { css } from "styled-components"

import { Button, Icon } from "../elements"
import { ThemeContext } from "./theme-provider"

const StyledThemeSwitcher = styled.div`
  & .moon,
  .sun,
  .sun-beams {
    transform-origin: center center;
  }
  & .moon,
  .sun,
  .sun-beams {
    fill: var(--color-gray-base);
  }
  &:hover {
    & .moon,
    .sun,
    .sun-beams {
      fill: var(--color-gray-40);
    }
  }
  &:focus,
  :focus-visible {
    & .moon,
    .sun,
    .sun-beams {
      fill: var(--color-gray-20);
    }
  }
  &:active {
    & .moon,
    .sun,
    .sun-beams {
      fill: var(--color-gray-00);
    }
  }
  & .sun {
    transition: transform var(--duration-slow) ease;
  }
  & .sun-beams {
    transition: transform var(--duration-slow), opacity var(--duration-slow);
  }
  & .moon > rect {
    fill: white;
  }
  & .moon > circle {
    fill: black;
  }

  ${props =>
    props.theme === "dark" &&
    css`
      & .sun {
        transform: scale(2.196);
        transition-timing-function: ease-in;
        transition-duration: var(--duration-natural);
      }
      & .sun-beams {
        transform: rotateZ(-25deg);
        transition-duration: var(--duration-immediate);
        opacity: 0;
      }
      & .moon > circle {
        transform: translateX(-8.44px);
        transition: transform var(--duration-natural) ease-out
          var(--duration-natural);
        @supports (cx: 1) {
          transform: translateX(0);
          cx: 15.56;
          transition: cx var(--duration-natural) ease-out
            var(--duration-natural);
        }
      }
    `}
`

const SunAndMoon = () => (
  <svg
    data-testid="sun-and-moon"
    className="sun-and-moon"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="currentColor"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g className="sun-beams">
      <path
        id="beam"
        d="M12 5.53125C11.7265 5.53125 11.4642 5.4226 11.2708 5.2292C11.0774 5.03581 10.9688 4.7735 10.9688 4.5V2.25C10.9688 1.9765 11.0774 1.71419 11.2708 1.5208C11.4642 1.3274 11.7265 1.21875 12 1.21875C12.2735 1.21875 12.5358 1.3274 12.7292 1.5208C12.9226 1.71419 13.0312 1.9765 13.0312 2.25V4.5C13.0312 4.7735 12.9226 5.03581 12.7292 5.2292C12.5358 5.4226 12.2735 5.53125 12 5.53125Z"
      />
      <path
        id="beam_2"
        d="M12 22.7812C11.7265 22.7812 11.4642 22.6726 11.2708 22.4792C11.0774 22.2858 10.9688 22.0235 10.9688 21.75V19.5C10.9688 19.2265 11.0774 18.9642 11.2708 18.7708C11.4642 18.5774 11.7265 18.4688 12 18.4688C12.2735 18.4688 12.5358 18.5774 12.7292 18.7708C12.9226 18.9642 13.0312 19.2265 13.0312 19.5V21.75C13.0312 22.0235 12.9226 22.2858 12.7292 22.4792C12.5358 22.6726 12.2735 22.7812 12 22.7812Z"
      />
      <path
        id="beam_3"
        d="M17.3036 7.72781C17.0997 7.72779 16.9003 7.66731 16.7308 7.55402C16.5612 7.44073 16.4291 7.27972 16.351 7.09134C16.273 6.90296 16.2525 6.69566 16.2922 6.49565C16.3319 6.29565 16.4301 6.11191 16.5742 5.96766L18.1652 4.37672C18.3594 4.18753 18.6203 4.08245 18.8915 4.08424C19.1626 4.08602 19.4222 4.19453 19.6139 4.38626C19.8056 4.57799 19.9141 4.83753 19.9159 5.10867C19.9177 5.37982 19.8126 5.64076 19.6234 5.835L18.0325 7.42594C17.9369 7.52178 17.8232 7.59778 17.6982 7.64959C17.5731 7.70139 17.439 7.72798 17.3036 7.72781V7.72781Z"
      />
      <path
        id="beam_4"
        d="M5.10583 19.9256C4.90186 19.9256 4.70248 19.8651 4.5329 19.7517C4.36332 19.6384 4.23116 19.4773 4.15314 19.2888C4.07511 19.1004 4.05473 18.893 4.09456 18.693C4.1344 18.4929 4.23266 18.3092 4.37693 18.165L5.96786 16.5741C6.06315 16.4762 6.17692 16.3983 6.30257 16.3448C6.42822 16.2913 6.56325 16.2633 6.69982 16.2624C6.83638 16.2615 6.97177 16.2877 7.09811 16.3395C7.22445 16.3914 7.33924 16.4678 7.43581 16.5644C7.53238 16.661 7.6088 16.7757 7.66065 16.9021C7.7125 17.0284 7.73873 17.1638 7.73783 17.3004C7.73693 17.437 7.70892 17.572 7.65541 17.6976C7.60191 17.8233 7.52398 17.9371 7.42614 18.0323L5.83521 19.6233C5.73954 19.7192 5.62586 19.7953 5.50069 19.8472C5.37552 19.8991 5.24133 19.9258 5.10583 19.9256V19.9256Z"
      />
      <path
        id="beam_5"
        d="M21.75 13.0312H19.5C19.2265 13.0312 18.9642 12.9226 18.7708 12.7292C18.5774 12.5358 18.4688 12.2735 18.4688 12C18.4688 11.7265 18.5774 11.4642 18.7708 11.2708C18.9642 11.0774 19.2265 10.9688 19.5 10.9688H21.75C22.0235 10.9688 22.2858 11.0774 22.4792 11.2708C22.6726 11.4642 22.7812 11.7265 22.7812 12C22.7812 12.2735 22.6726 12.5358 22.4792 12.7292C22.2858 12.9226 22.0235 13.0312 21.75 13.0312Z"
      />
      <path
        id="beam_6"
        d="M4.5 13.0312H2.25C1.9765 13.0312 1.71419 12.9226 1.5208 12.7292C1.3274 12.5358 1.21875 12.2735 1.21875 12C1.21875 11.7265 1.3274 11.4642 1.5208 11.2708C1.71419 11.0774 1.9765 10.9688 2.25 10.9688H4.5C4.7735 10.9688 5.03581 11.0774 5.2292 11.2708C5.4226 11.4642 5.53125 11.7265 5.53125 12C5.53125 12.2735 5.4226 12.5358 5.2292 12.7292C5.03581 12.9226 4.7735 13.0312 4.5 13.0312Z"
      />
      <path
        id="beam_7"
        d="M18.8946 19.9256C18.7591 19.9258 18.6249 19.8991 18.4997 19.8472C18.3745 19.7953 18.2608 19.7192 18.1652 19.6233L16.5742 18.0323C16.3851 17.8381 16.28 17.5772 16.2818 17.306C16.2835 17.0349 16.3921 16.7753 16.5838 16.5836C16.7755 16.3919 17.035 16.2834 17.3062 16.2816C17.5773 16.2798 17.8383 16.3849 18.0325 16.5741L19.6235 18.165C19.7677 18.3092 19.866 18.4929 19.9058 18.693C19.9456 18.893 19.9253 19.1004 19.8472 19.2888C19.7692 19.4773 19.6371 19.6384 19.4675 19.7517C19.2979 19.8651 19.0985 19.9256 18.8946 19.9256V19.9256Z"
      />
      <path
        id="beam_8"
        d="M6.69633 7.72781C6.56093 7.72807 6.42681 7.70153 6.30171 7.64972C6.17661 7.59791 6.063 7.52185 5.96743 7.42593L4.37649 5.835C4.1873 5.64076 4.08222 5.37982 4.08401 5.10867C4.08579 4.83752 4.1943 4.57799 4.38603 4.38626C4.57776 4.19453 4.8373 4.08602 5.10844 4.08424C5.37959 4.08245 5.64053 4.18753 5.83477 4.37672L7.42571 5.96765C7.56984 6.1119 7.66797 6.29564 7.7077 6.49565C7.74742 6.69566 7.72696 6.90295 7.6489 7.09134C7.57084 7.27972 7.43868 7.44073 7.26913 7.55401C7.09958 7.6673 6.90025 7.72778 6.69633 7.72781V7.72781Z"
      />
    </g>
    <path
      className="sun"
      style={{ mask: "url(#moon-mask)" }}
      d="M12 16.7813C11.0544 16.7813 10.13 16.5008 9.34368 15.9755C8.55741 15.4501 7.94458 14.7034 7.5827 13.8297C7.22082 12.956 7.12614 11.9947 7.31062 11.0672C7.49511 10.1398 7.95048 9.28782 8.61915 8.61915C9.28782 7.95048 10.1398 7.49511 11.0672 7.31062C11.9947 7.12614 12.956 7.22082 13.8297 7.5827C14.7034 7.94458 15.4501 8.55741 15.9755 9.34368C16.5008 10.13 16.7813 11.0544 16.7813 12C16.7798 13.2676 16.2755 14.4829 15.3792 15.3792C14.4829 16.2755 13.2676 16.7798 12 16.7813V16.7813Z"
    />
    <mask className="moon" id="moon-mask">
      <rect x="0" y="0" width="100%" height="100%" />
      <circle cx="24" cy="9.56" r="4.78" />
    </mask>
  </svg>
)

const ThemeSwitcher = () => {
  const { t } = useTranslation("components/theme-switcher")
  const { theme, saveTheme } = useContext(ThemeContext)

  const toggle = () => {
    theme === "light" ? saveTheme("dark") : saveTheme("light")
  }

  return theme ? (
    <StyledThemeSwitcher theme={theme}>
      <Button
        as="button"
        $type="text"
        title={t("aria")}
        aria-label={t("aria")}
        onClick={() => toggle()}
      >
        <Icon $type="text">
          <SunAndMoon></SunAndMoon>
        </Icon>
      </Button>
    </StyledThemeSwitcher>
  ) : null
}

export default ThemeSwitcher
