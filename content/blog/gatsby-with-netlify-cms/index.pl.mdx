---
title: Gatsby z Netlify CMS
description: 'W tym wpisie przyjrzymy siÄ™ bliÅ¼ej Netlify CMS. Jest to przykÅ‚ad CMSa nowego typu, ktÃ³ry jest oparty o Git. Zintegrujemy go z przykÅ‚adowym projektem Gatsby.'
date: 2022-09-23T16:00:00+02:00
updated: 2022-09-23T16:00:00+02:00
image:
  alt: 'PiÄ™Ä‡ metalowych kÃ³Å‚ zÄ™batych na czarnym tle'
  caption: 'ZdjÄ™cie autorstwa Miguel Ã. PadriÃ±Ã¡n'
  src: 'pexels-miguel-Ã¡-padriÃ±Ã¡n-3785933.jpg'
categories: ['rozwÃ³j sieci']
tags: ['gatsby', 'netlify', 'cms']
type: 'post'
---

JeÅ¼eli jesteÅ› web developerem, prawdopodobnie rozpoznajesz to zdjÄ™cie. Nawet jeÅ¼eli nie jesteÅ› - prawdopodobnie wiesz co to jest.

![Panel WordPress](wordpress-cms.png)

Panel WordPress - prosty i intuicyjny sposÃ³b zarzÄ…dzania treÅ›ciami na twojej stronie. Nie musisz znaÄ‡ PHP, MySQL lub HTML, Å¼eby stworzyÄ‡ coÅ› jak wpis na blogu. Zawiera wiele zakÅ‚adek, pÃ³l i przyciskÃ³w, ktÃ³re pomagajÄ… w tworzeniu treÅ›ci. WraÅ¼enia z uÅ¼ytkownika muszÄ… byÄ‡ dobre, bo jest to nadal najpopularniejszy CMS na rynku. Ale ta popularnoÅ›Ä‡ wiÄ…Å¼e siÄ™ z ogromnym kosztem - jest to gÅ‚Ã³wny cel dla hakerÃ³w i spamerÃ³w. Potencjalne luki w zabezpieczeniach to nie jedyne minusy, ale ten post nie jest o tym.

Ostatecznie, twoje treÅ›ci muszÄ… znajdowaÄ‡ siÄ™ w skÅ‚adni HTML, aby zostaÅ‚y zinterpretowane przez przeglÄ…darkÄ™. MÃ³gÅ‚byÅ› kodowaÄ‡ wszystko rÄ™cznie. Ja sam do stworzenia tego posta uÅ¼ywam MDX - jest to specjalny format Å‚Ä…czÄ…cy Markdown i JavaScript, ktÃ³ry ty widzisz jako stronÄ™ internetowÄ…. Wszystko jest statyczne i bezpieczne. Ale wymaga to nauki specjalnych skÅ‚adni, a nie kaÅ¼dy chce tego. Dodatkowo Å‚atwo w ten sposÃ³b coÅ› zepsuÄ‡, dlatego chciaÅ‚em sprawdziÄ‡ jak dziaÅ‚ajÄ… Git-based CMS.

## Netlify CMS

Netlify CMS jest przykÅ‚adem systemu zarzÄ…dzania treÅ›ci, bazujÄ…cym na systemie kontroli wersji GIt. Ten CMS uÅ¼ywa Git'a pod maskÄ…. Pozwala to na trzymanie wszystkiego w repozytorium Git - treÅ›ci obok kodu. Ma on trochÄ™ zalet w porÃ³wnaniu do standardowych CMS'Ã³w takich jak WordPress. JednoczeÅ›nie nie poÅ›wiÄ™ca Å‚atwoÅ›ci uÅ¼ytkowania. U samych podstaw, Netlify CMS to jest aplikacja React, ktÃ³ra owija Git workflow. Dlatego nie musisz uczyÄ‡ siÄ™ narzÄ™dzi takich jak Git, Yaml czy Markdown, aby go uÅ¼ywaÄ‡. Oferuje on bogaty interfejs uÅ¼ytkownika dostÄ™pny z poziomu przeglÄ…darki, podobnie jak WordPress. Jest przyjazny dla nie-technicznych uÅ¼ytkownikÃ³w. Ale potrzeba trochÄ™ wiedzy, aby go skonfigurowaÄ‡. Dlatego zintegruje Netlify CMS z przykÅ‚adowym projektem Gatsby w tym wpisie. Postaram siÄ™ odtworzyÄ‡ strukturÄ™ posta z mojego bloga.

<Callout variant="info">

JeÅ¼eli chcesz poznaÄ‡ szerszy obraz jak Gatsby lub Netlify CMS wpisuje siÄ™ w [architekturÄ™ Jamstack](/pl/blog/jamstack-what-why-how/), napisaÅ‚em o tym post.

</Callout>

## Jak uÅ¼ywaÄ‡ Gatsby z Netlify CMS?

Zaczniemy od zainicjowania nowego projektu Gatsby. W tym celu moÅ¼emy uÅ¼yÄ‡ [Gatsby CLI](https://www.gatsbyjs.com/docs/reference/gatsby-cli/).

```bash
gatsby new netlify-cms-example https://github.com/gatsbyjs/gatsby-starter-hello-world
```

NastÄ™pnie musimy zainstalowaÄ‡ dwie paczki: `netlify-cms-app` i `gatsby-plugin-netlify-cms`. Pierwsza z nich jest odpowiedzialna za stworzenie wczeÅ›niej wspomnianej aplikacji, druga zintegruje jÄ… z frameworkiem Gatsby.

```bash
npm install netlify-cms-app gatsby-plugin-netlify-cms
```

Wtyczki Gatsby muszÄ… byÄ‡ zarejestrowane, aby dziaÅ‚aÄ‡. Musimy dodaÄ‡ nowÄ… zaleÅ¼noÅ›Ä‡ do tablicy.

```js
//gatsby-config.js

module.exports = {
  plugins: [`gatsby-plugin-netlify-cms`]
}
```

Sam plugin nie wymaga konfiguracji, ale Netlify CMS wymaga. Nie ma on pojÄ™cia jakiego typu treÅ›ci ty albo edytorzy bÄ™dziecie tworzyÄ‡. Dlatego, potrzebuje on pliku `config.yml` z **folderami, kolekcjami** i rÃ³Å¼nymi **polami.** Na razie skopiujmy przykÅ‚adowÄ… konfiguracjÄ™. Wklejamy jÄ… do folderu `static/admin`. Gatsby przekopiuje jego zawartoÅ›Ä‡ do wyjÅ›ciowego build'u.

```yml
#static/admin/config.yml
backend:
  name: test-repo

media_folder: static/assets
public_folder: /assets

collections:
  - name: blog
    label: Blog
    folder: blog
    create: true
    fields:
      - { name: path, label: Path }
      - { name: date, label: Date, widget: datetime }
      - { name: title, label: Title }
      - { name: body, label: Body, widget: markdown }
```

Teraz moÅ¼emy wpisaÄ‡ `gatsby develop` w terminalu. JeÅ¼eli skonfigurowaÅ‚eÅ› wszystko poprawnie, podobny interfejs powinien powitaÄ‡ ciÄ™ pod adresem `http://localhost:8000/admin/`:

![Netlify CMS z domyÅ›lnÄ… konfiguracjÄ…](netlify-cms-default-config.png)

## Konfiguracja Netlify CMS

MyÅ›lÄ™, Å¼e to jest dobry moment na eksploracjÄ™ poszczegÃ³lnych opcji konfiguracyjnych. PoniÅ¼ej jest kilka waÅ¼nych, ogÃ³lnych:

- `backend` - okreÅ›la jak uzyskaÄ‡ dostÄ™p na twojej stronie. Przyjmuje nastÄ™pujÄ…ce opcje:
  - `repo` - Å›cieÅ¼ka do repozytorium (nazwa uÅ¼ytkownika/nazwa repo).
  - `branch` - gaÅ‚Ä…Åº do przechowywania treÅ›ci.
  - `base_url` - nazwa klienta OAuth, gdy uÅ¼ywasz zewnÄ™trznego serwera OAuth.
  - `cms_label_prefix` - etykieta dla Å¼Ä…daÅ„ pull lub merge, gdy editorial workflow jest w uÅ¼yciu.
- `publish_mode` - pozwala wÅ‚Ä…czyÄ‡ editorial workflow - wiÄ™cej etapÃ³w przed publikacjÄ….
- `media_folder` - relatywna Å›cieÅ¼ka do folderu dla udostÄ™pnionych plikÃ³w.
- `public_folder` - Å›cieÅ¼ka, dziÄ™ki ktÃ³rej moÅ¼na dostaÄ‡ siÄ™ do udostÄ™pnionych plikÃ³w w juÅ¼ opublikowanej stronie.
- `site_url` - adres URL do opublikowanej strony.

### Kolekcje

IstniejÄ… specjalne opcje dla kolekcji. Kolekcja to lista obiektÃ³w tego samego typu. Posty na blogu, przepisy lub produkty sÄ… dobrymi przykÅ‚adami. KaÅ¼da skonfigurowana kolekcja wyÅ›wietla siÄ™ na lewym pasku bocznym, co byÅ‚o widaÄ‡. Te opcje okreÅ›lajÄ… ksztaÅ‚t twoich treÅ›ci.

- `name` - unikalny identyfikator dla kolekcji.
- `identifier_field` - to pole jest uÅ¼yte (zamiast domyÅ›lnego) podczas tworzenia adresÃ³w URL. Netlify CMS oczekuje pola `title` w domyÅ›le.
- `label` - etykieta dla kolekcji w interfejsie uÅ¼ytkownika. W domyÅ›le pole `name`, ale te pola mogÄ… siÄ™ rÃ³Å¼niÄ‡.
- `label_singular` - to samo co powyÅ¼ej, tylko dla pojedynczych elementÃ³w. Pole `label` w domyÅ›le.
- `description` - opcjonalny opis wyÅ›wietlony w interfejsie.
- `folder` lub `files` - typ kolekcji. Opcja `folder` przyjmuje Å›cieÅ¼kÄ™ do folderu. WewnÄ…trz tego folderu powinny znajdowaÄ‡ siÄ™ pliki o tym samym formacie i polach (np. wpisy na blogu). Opcja `files` zawiera pojedynczo skonfigurowane pliki (np. strona gÅ‚Ã³wna).
- `filter` - opcja tylko dla folderu. Jak sugeruje nazwa - filtruje pliki z folderu. Przyjmuje pola `field` i `value`, aby wykorzystaÄ‡ do filtracji.
- `create` - kolejna opcja dla folderu. WartoÅ›Ä‡ `true` pozwala uÅ¼ytkownikom na tworzenie nowych wartoÅ›ci w kolekcji. `false` w domyÅ›le.
- `extension` - wykorzystywane do znajdowania i zapisywania plikÃ³w w folderze kolekcji.
- `format` - wykorzystane do parsowania i zapisywania plikÃ³w w folderze kolekcji.
- `slug` - szablon do generowania nazw plikÃ³w na podstawie rÃ³Å¼nych pÃ³l. WewnÄ…trz tej opcji moÅ¼esz korzystaÄ‡ z wielu znacznikÃ³w, takich jak:
  - `{{slug}}` - wersja tytuÅ‚u, ktÃ³ra jest URL-safe.
  - `{{year}}` - rok stworzenia pliku.
  - `{{second}}` - sekunda stworzenia pliku.
  - `{{field_name}}` - poza domyÅ›lnymi znacznikami, moÅ¼esz takÅ¼e wykorzystaÄ‡ niestandardowe znaczniki. Wymaga to otoczenia nazwy pola podwÃ³jnymi nawiasami klamrowymi.
- `preview_path` - szablon do generowania Å›cieÅ¼ek do treÅ›ci na stronie, ktÃ³ra jest online. Tagi sÄ… takie same jak poprzednio z wyjÄ…tkami:
  - `{{slug}}` - tutaj oznacza caÅ‚y adres dla bieÅ¼Ä…cego elementu.
  - Tagi zwiÄ…zane z datami mogÄ… wymagaÄ‡ dodatkowej konfiguracji.
  - `{[dirname}}` - Å›cieÅ¼ka do folderu rodzica kolekcji.
  - `{{filename}}` - nazwa pliku.
  - `{{extension}}` - rozszerzenie pliku.

### Pola

KaÅ¼dy element kolekcji moÅ¼e zawieraÄ‡ wiele pÃ³l. Kiedy klikniesz, aby stworzyÄ‡ nowy element kolekcji (â€New Blogâ€ w naszym przypadku), zobaczysz elementy interfejsu jak te.

![DomyÅ›lne pola w Netlify CMS](netlify-cms-default-fields.png)

WyglÄ…da to podobnie do standardowego systemu zarzÄ…dzania treÅ›ciami. JeÅ¼eli przyjrzysz siÄ™ dokÅ‚adnie poprzedniej konfiguracji i porÃ³wnasz jÄ… z tym zrzutem ekranu, zauwaÅ¼ysz, Å¼e opcje pÃ³l odpowiadajÄ… elementom interfejsu. Opcja `fields` mapuje widgety i wartoÅ›ci zapisane w pliku. Przyjmuje listÄ™ obiektÃ³w z nastÄ™pujÄ…cymi opcjami:

- `name` - unikalny identyfikator pola.
- `label` - etykieta pola w interfejsie uÅ¼ytkownika.
- `widget` - definiuje typy danych i elementy do ich wprowadzania. Przyjmuje string, ktÃ³ry determinuje typ widgetu. IstniejÄ… domyÅ›lne widgety, takie jak date, image czy markdown. Dodatkowe opcje pozwalajÄ… na ich konfiguracje. Te opcje rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od typu, ale sÄ… teÅ¼ opcje wspÃ³Å‚dzielone jak `required` lub `hint`.
- `required` - okreÅ›la czy pole jest wymagane.
- `hint` - pomocniczy tekst wyÅ›wietlany w interfejsie uÅ¼ytkownika.
- `default` - domyÅ›lna wartoÅ›Ä‡ pola. DostÄ™pna dla wiÄ™kszoÅ›ci widgetÃ³w.
- `pattern` - lista skÅ‚adajÄ…ca siÄ™ z wzorca regex i komunikatu o bÅ‚Ä™dzie - wykorzystywane do walidacji pÃ³l.

## Wpisy na blogu z Netlify CMS

PrzyswoiliÅ›my sporo informacji, ale myÅ›lÄ™, Å¼e teraz jesteÅ›my gotowi, aby zastÄ…piÄ‡ domyÅ›lnÄ… konfiguracjÄ™ naszÄ… wÅ‚asnÄ…. Chcemy mieÄ‡ moÅ¼liwoÅ›Ä‡ dodawania, modyfikowania i usuwania typowych wpisÃ³w na blogu, zawierajÄ…cych tytuÅ‚y, opisy, zdjÄ™cia, tagi itp. Zacznijmy konfigurujÄ…c naszÄ… kolekcjÄ™.

```yml
#static/admin/config.yml
collections:
  - name: blog
    label: Blog
    label_singular: Post
    folder: content/blog
    create: true
    delete: true
    extension: markdown
    format: frontmatter
    slug: '{{slug}}'
    preview_path: 'blog/{{filename}}'
    fields:
    # Below ğŸ‘‡
```

Pola `name` i `label` mogÄ… pozostaÄ‡ takie same. DodaÅ‚em takÅ¼e `label_singular` dla pojedynczych postÃ³w. UÅ¼ytkownik CMS'a ma mieÄ‡ moÅ¼liwoÅ›Ä‡ tworzenia i usuwania wpisÃ³w. Posty powinny byÄ‡ w formacie markdown z dodatkowymi informacjami w formacie frontmatter. Musimy dodaÄ‡ pola, ktÃ³re pozwolÄ… na uzupeÅ‚nienie tych informacji. Pole `title` jest wymagane do tworzenia adresu URL. Pole `description` moÅ¼e byÄ‡ wyÅ›wietlone, albo uÅ¼yte w meta tagach.

```yml
fields:
  - { name: title, label: Title }
  - { name: description, label: Description, widget: text }
  - { name: date, label: Publication Date, widget: datetime }
  - { name: updated, label: Update Date, widget: datetime }
  - name: image
    label: Featured Image
    widget: object
    summary: '{{fields.src}}'
    fields:
      - { name: src, label: Image source, widget: image }
      - { name: alt, label: Alt text, widget: string }
      - {
          name: credit,
          label: Author of the image,
          widget: string,
          required: false
        }
  - {
      name: tags,
      label: Tags,
      widget: select,
      multiple: true,
      options:
        [
          'Web Development',
          'Design',
          'Computer Science',
          'Data Science',
          'Mathematics'
        ],
      default: ['Computer Science'],
      min: 1,
      max: 4,
      required: false
    }
  - { name: body, label: Body, widget: markdown }
```

UÅ¼ytkownik moÅ¼e wybieraÄ‡ daty z widgetem `datetime`. WyrÃ³Å¼nione zdjÄ™cie powinno byÄ‡ obiektem i zawieraÄ‡ pola, aby byÅ‚o dostÄ™pne. Po wybraniu zdjÄ™cia uÅ¼ywajÄ…c widgetu `image`, uÅ¼ytkownik powinien dodaÄ‡ alternatywny tekst i dodaÄ‡ informacje o autorze zdjÄ™cia. DodaÅ‚em takÅ¼e kilka tagÃ³w z elementem `select`dla organizacji bloga. UÅ¼ytkownik moÅ¼e tworzyÄ‡ zawartoÅ›Ä‡ wpisu wykorzystujÄ…c element `markdown`. Po tej konfiguracji, nasz CMS powinien wyglÄ…daÄ‡ tak:

![Netlify CMS z niestandardowÄ… konfiguracjÄ…](netlify-cms-custom-config.png)

## ÅÄ…czenie Netlify CMS z repozytorium Git

UÅ¼ytkownik od teraz moÅ¼e uÅ¼ywaÄ‡ naszego CMSa do tworzenia wpisÃ³w, ale wprowadzone informacje pozostajÄ… tylko w przeglÄ…darce. Potrzebujemy repozytorium git, aby zapisaÄ‡ te informacje. Najpierw musimy poÅ‚Ä…czyÄ‡ nasze lokalne repozytorium z serwisem takim jak GitHub. Po zrobieniu tego, zrÃ³bmy krok wstecz. Netlify CMS to jest webowa aplikacja SPA, jak wczeÅ›niej wspomniaÅ‚em. Z tego wynika, Å¼e chcemy dokonywaÄ‡ zmian w naszym repozytorium z poziomu przeglÄ…darki. Wymaga to uwierzytelniania, a GitHub wymaga do tego serwera. [Netlify](https://www.netlify.com/) oferuje rozwiÄ…zanie i moÅ¼e siÄ™ tym zajÄ…Ä‡. ÅÄ…czenie repozytorium z Netlify jest prostolinijne. Tworzysz tam konto, wybierasz Sites > Add new site > Import an existing project i podÄ…Å¼asz za instrukcjami. MoÅ¼emy dodaÄ‡ uwierzytelnianie do naszej opublikowanej strony wykorzystujÄ…c [konfiguracjÄ™ OAuth](https://docs.netlify.com/visitor-access/oauth-provider-tokens/#using-an-authentication-provider). Musimy dodaÄ‡ nowÄ… aplikacjÄ™ OAuth na stronie GitHub i zapisaÄ‡ wygenerowane credentials do naszej strony w Netlify. OdtÄ…d nasz CMS moÅ¼e dokonywaÄ‡ zmian w naszym repozytoriumâ€¦ no prawie. Musimy takÅ¼e dodaÄ‡ brakujÄ…ce informacje do naszej konfiguracji. NastÄ™pnie moÅ¼emy zapisaÄ‡ zmiany i wysÅ‚aÄ‡ je do repozytorium GitHub.

```yml
#static/admin/config.yml
backend:
  name: github
  repo: your-username/repo-name
  branch: main
```

OdwiedÅº `https://twoja-strona.netlify.app/admin/`, a twoja przeglÄ…darka powinna wyÅ›wietliÄ‡ stronÄ™ uwierzytelniajÄ…cÄ… jak ta poniÅ¼ej.

![Uwierzytelnianie w Netlify CMS](netlify-cms-authentication.png)

Po zalogowaniu moÅ¼esz stworzyÄ‡ wpis, wypeÅ‚niÄ‡ wszystkie jego pola i kliknÄ…Ä‡ â€œpublish nowâ€. Po kilku sekundach twoje zmiany zostanÄ… zapisane do repozytorium. Hura! UdaÅ‚o nam siÄ™. â€œAleâ€¦ nasze posty nie wyÅ›wietlajÄ… siÄ™ na stronieâ€, moÅ¼esz dodaÄ‡. OdpowiedziaÅ‚bym - tak, sÅ‚uszna uwaga. JednakÅ¼e, celem tego wpisu byÅ‚a integracja pomiÄ™dzy Netlify CMS i Gatsby. Wszystko inne chciaÅ‚em uczyniÄ‡ tak prostym jak to moÅ¼liwe, dlatego zaczÄ…Å‚em z minimalnÄ… konfiguracjÄ…. JeÅ¼eli zaczÄ…Å‚eÅ› majÄ…c bloga, to masz juÅ¼ tÄ™ czÄ™Å›Ä‡. Ten wpis staje siÄ™ dÅ‚ugi, wiÄ™c na tym zakoÅ„czÄ™. ByÄ‡ moÅ¼e dodam drugÄ… czÄ™Å›Ä‡, w ktÃ³rej wyÅ›wietlimy nasze wpisy.
